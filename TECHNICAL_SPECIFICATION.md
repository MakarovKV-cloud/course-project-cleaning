# Техническое задание: система управления заявками клининговой компании

**Студент:** Макаров Кирилл Витальевич

**Группа:** 2307В2

## 1. Описание проекта
### 1.1 Название системы
Система управления заявками клининговой компании

### 1.2 Назначение
Система предназначена для автоматизации процессов создания, обработки и контроля заявок на клининг, а также управления пользователями и административными функциями.

## 2. Функциональные требования

### 2.1 Общие функции для всех пользователей

#### 2.1.1 Авторизация
- **Описание:** 
  Окно входа содержит поля: логин (никнейм) и пароль, а также кнопку "Войти".
- **Процесс:**
  - После ввода данных и нажатия кнопки происходит проверка введенных данных с записью в базе данных.
  - В случае совпадения:
    - Пользователь перенаправляется в систему согласно своей роли (Пользователь, Клинер, Администратор).
  - В случае несовпадения:
    - Выводится диалоговое окно с сообщением об ошибке ("Аккаунт не найден или данные неверны").
    - В диалоговом окне две кнопки:
      - "Закрыть" — позволяет вернуться к форме входа и скорректировать данные.
      - "Создать аккаунт" — переводит пользователя на страницу регистрации.
- **Вход:** логин, пароль
- **Результат:** успешный вход — доступ к соответствующей системе; неудача — сообщение об ошибке.

#### 2.1.2 Создание аккаунта
- **Описание:**
  Форма содержит поля: фамилия, имя, отчество, логин, пароль, повторный пароль, а также кнопку "Создать аккаунт".
- **Логика:**
  - Все поля, кроме отчества, обязательны к заполнению.
  - После нажатия:
    - Выполняется валидация данных (проверка заполненности, уникальности логина, совпадения паролей).
    - В случае успеха:
      - Создается объект "Пользователь" в базе данных.
      - Появляется диалоговое окно с подтверждением успешного создания.
      - Пользователь автоматически перенаправляется на страницу входа.
    - В случае ошибок (например, незаполненные поля, логин уже существует, пароли не совпадают):
      - Выводится диалоговое окно с перечнем ошибок.
      - Пользователю остается на странице регистрации для исправления данных.
- **Вход:** фамилия, имя, отчество, логин, пароль, повторный пароль
- **Результат:** создание аккаунта и переход к авторизации или отображение ошибок.

---

### 2.2 Функции для авторизованных пользователей

#### 2.2.1 Просмотр своих заявок
- **Описание:** Пользователи с ролью "Пользователь" могут просматривать список своих активных и прошлых заявок.
- **Детали:** реализуется таблицей с данными по заявкам, статусом, датой и стоимостью.

#### 2.2.2 Создание заявки на клининг
- **Описание:** 
  После входа пользователь выбирает кнопку "Создать заявку", после чего открывается форма с полями:
  - площадь уборки;
  - список услуг (у некоторых услуг есть зависимость от площади);
  - дата клининга;
  - город (выпадающий список);
  - район;
  - адрес;
  - поле для итоговой стоимости;
  - кнопка "Перейти к оплате".
- **Процесс:**
  - Пользователь заполняет поля.
  - На основе введенных данных автоматически рассчитывается итоговая стоимость.
  - Перед оплатой появляется диалоговое окно для подтверждения данных.
  - При подтверждении осуществляется переход к оплате.
- **Вход:** площадь, выбранные услуги, дата, город, район, адрес.
- **Результат:** подготовка данных к оплате.

#### 2.2.3 Оплата заявки
- **Описание:** Пользователь вводит данные банковской карты:
  - номер карты;
  - срок действия;
  - CVV.
- **Процесс:**
  - Проверка корректности введенных данных.
  - При успехе создается запись о платеже и создается объект "Заявка" в системе.
  - При ошибке выводится сообщение об ошибке оплаты (например, некорректные данные, недостаточно средств).
- **Вход:** номер карты, срок действия, CVV.
- **Результат:** успешная оплата — появление объекта 'Заявка'; при ошибке — повторная попытка.

---

### 2.3 Административные функции

#### 2.3.1 Управление аккаунтами
- **Изменение роли:** 
  Админ выбирает аккаунт из списка, нажимает "Изменить должность", после чего появляется окно с радиобатонами для выбора роли (Пользователь, Клинер, Админ).
- **Обновление:** 
  После выбора и подтверждения роль в базе данных обновляется.

#### 2.3.2 Управление заявками
- **Обновление заявки:**
  Админ может выбрать заявку и изменить ее статус (например, "Новая", "В процессе", "Завершена") и назначить клинера из доступного списка.
- **Результат:** обновленные данные сохраняются в базе.

#### 2.3.3 Управление городами
- **Добавление города:** 
  Ввод названия нового города с кнопкой "Добавить" — создается новый объект "Город".
- **Удаление города:**
  Выбор существующего города и нажатие "Удалить" — удаляет город из базы.
- **Результат:** изменение списка городов.

---

### 2.4 Функции для клинеров

#### 2.4.1 Просмотр адресованных заявок
Клинеры авторизуются и видят список заявок, назначенных им, с деталями:
- адресом;
- датой;
- списком услуг;
- статусом (например, "В ожидании", "В работе", "Завершена").
- Возможна функция фильтрации и сортировки заявок по статусу и дате.

## Структура базы данных
**Описание:** Хранит перечень ролей пользователей системы.

### Таблица 1: Roles
- Поля:

Id (int, PK) — Уникальный идентификатор роли.

Name (string) — Название роли (например, "Пользователь", "Клинер").

- **Связи:**

Нет внешних ключей.

### Таблица 2: Users
**Описание:* Хранит информацию о зарегистрированных пользователях.

- Поля:

Id (int, PK) — Уникальный идентификатор пользователя.

LastName (string) — Фамилия.

FirstName (string) — Имя.

MiddleName (string?) — Отчество. *(nullable)*

Login (string) — Уникальный логин.

Password (string) — пароль.

RoleId (int, FK → Roles) — Внешний ключ на роль пользователя.
CreatedAt (datetime) — Дата регистрации.

- **Связи:**

Связь много-к-одному с таблицей Roles (один пользователь может иметь одну роль)

### Таблица 3: Requests
**Описание:** Хранит информацию о заявках на уборку.

- Поля:

Id (int, PK) — Уникальный идентификатор заявки.

UserId (int, FK → Users) — Внешний ключ на пользователя, сделавшего заявку.

Area (decimal) — Площадь уборки.

Services (string) — Выбранные услуги.

CleaningDate (date) — Запланированная дата уборки.

CityId (int, FK → Cities) — Внешний ключ на город.

District (string) — Район.

Address (string) — Адрес.

TotalCost (decimal) — Итоговая стоимость.

Status (string) — Статус заявки (например, "Новая", "В работе").

ClinerId (int?, FK → Cliners) — Назначенный клинер *(nullable)*.

PaymentId (int?, FK → Payments) — Связанный платеж *(nullable)*.

CreatedAt (datetime) — Дата создания.

- **Связи:**

UserId → Users.Id  Связь много-к-одному с таблицей Users (один пользователь может оставить много заявок)

CityId → Cities.Id Связь много-к-одному с таблицей Cities (один город может иметь много заявок)

ClinerId → Cliners.Id Связь много-к-одному с таблицей Cities (в одном городе может быть много заявок)

PaymentId → Payments.Id Связь один-ко-одному с таблицей Payments (одна заявка — один платеж)

### Таблица 4: Payments
**Описание:** Хранит информацию о платежах.

- Поля:

Id (int, PK) — Уникальный идентификатор платежа.

RequestId (int, FK → Requests) — Внешний ключ на заявку.

CardNumberMasked (string) — Маскированный номер карты.

PaymentDate (datetime) — Дата платежа.

Amount (decimal) — Сумма.

Status (string) — Статус платежа ("Успех", "Ошибка").

TransactionId (string) — Идентификатор транзакции систем оплаты.

- **Связи:**

RequestId → Requests.Id Связь один-ко-одному с таблицей Requests (один платеж — для одной заявки)

### Таблица 5: Cities
**Описание:** Перечень городов.

- Поля:

Id (int, PK) — Уникальный идентификатор города.

Name (string) — Название города.

- **Связи:**

Нет внешних ключей.

### Таблица 6: Services
**Описание:** Перечень доступных услуг.

- Поля:

Id (int, PK) — Уникальный идентификатор услуги.

Name (string) — Название услуги.

PricePerSquareMeter (decimal) — Цена за квадратный метр.

RequiresArea (bool) — Требует указания площади.

- **Связи:**

Нет внешних ключей.

### Таблица 7: Cliners
**Описание:** Информация о клинерах.

- Поля:

Id (int, PK) — Уникальный идентификатор.

UserId (int, FK → Users) — Внешний ключ на пользователя (представляет клинера).

Availability (string) — График работы или статус доступности.

- **Связи:**

UserId → Users.Id Связь много-к-одному с таблицей Users (один человек - 1 роль, в одной роли много представителей)

### Таблица 8: RequestAssignments
**Описание:** Назначения заявок клинерам.

- Поля:

Id (int, PK) — Уникальный идентификатор.

RequestId (int, FK → Requests) — Ссылка на заявку.

ClinerId (int, FK → Cliners) — Клинир, которому назначена заявка.

AssignedAt (datetime) — Дата назначения.

Status (string) — Статус выполнения заявки ("В ожидании", "В работе", "Завершена").

- **Связи:**

RequestId → Requests.Id Связь много-к-одному с таблицей Requests (один клинер может сделать много заявок, одну заявку делает один клинер)

ClinerId → Cliners.Id Связь много-к-одному с таблицей Cliners (один клинер — много заявок, одну заявка - один клинер)

## Основные формы приложения

### Форма 1: AuthorizationForm (Форма авторизации)
**Назначение:**
Позволяет зарегистрированным пользователям входить в систему, проверяя их учетные данные.

- Элементы управления:

TextBox для ввода логина

TextBox для ввода пароля 

Button "Войти" — инициирует проверку данных

Button "Создать аккаунт" — переходит на форму регистрации

- **Действия:**

При нажатии "Войти" выполняется попытка входа. В случае успеха — открывается соответствующая форма, соответствии с ролью. При ошибке — выводится сообщение с ошибкой ("Аккаунт не найден или данные неверны").

При выборе "Создать аккаунт" открывается форма регистрации.

### Форма 2: RegistrationForm (Форма создания нового аккаунта)
**Назначение:**
Позволяет новым пользователям зарегистрировать аккаунт, заполнив необходимые поля.

- Элементы управления:

TextBox для ввода фамилии

TextBox для ввода имени

TextBox для отчества (необязательное)

TextBox для логина

TextBox для пароля

TextBox для повторного пароля

Button "Создать аккаунт" — запускает проверку и создание пользователя

- **Действия:**

После нажатия "Создать аккаунт" выполняется валидация (заполненность, совпадение паролей, уникальность логина). При успехе создается пользователь, выводится сообщение об успехе, и пользователь автоматически перенаправляется на форму входа.

В случае ошибок — показывается список ошибок, оставаясь на этой форме.

### Форма 3: UserMainWindow (Для обычных пользователей)
**Назначение:**
Панель для просмотра заявок и создания новых.

- Элементы управления:

DataGrid — список своих заявок (статус, дата, стоимость)

Button "Создать заявку" — открывает форму заявки

- **Действия:**

Нажатие "Создать заявку" — открывает форму RequestsForm.

### Форма 4: RequestsForm (Созданиезаявки)
Назначение:
Позволяет пользователям внести новую заявку или редактировать существующую.

- Элементы управления:

TextBox — площадь уборки

CheckBox — список услуг с возможностью выбора

DatePicker — дата клининга

ComboBox — город

TextBox — район

TextBox — адрес

Label — итоговая стоимость (автоматический расчет при вводе)

Button "Перейти к оплате" — переходит к форме оплаты

- **Действия:**

При заполнении формы рассчитывается итоговая цена (может происходить автоматически или по кнопке)

Перед оплатой отображается диалог подтверждения.

После подтверждения осуществляется переход к форме оплаты.

### Форма 5: PaymentForm (Оплата заявки)
**Назначение:**
Обеспечивает ввод данных банковской карты и завершающий этап оплаты.

- Элементы управления:

TextBox — номер карты

TextBox — срок действия (месяц/год)

TextBox — CVV

Button "Оплатить" — инициирует проверку и платеж

- **Действия:**

После успешной проверки данных создается запись о платеже, статус меняется на "Успех", заявка завершается.

В случае ошибок показывается сообщение и возможность повторной попытки.

### Форма 6: ClinerRequestViewForm (Для клинеров)
**Назначение:**
Обеспечивает просмотр заявок, назначенных конкретному клинеру.

- Элементы управления:

DataGrid — заявки (адрес, дата, услуги, статус)

- **Действия:**

Клинеры могут менять статус своих заявок, например, "В работе", "Завершена".

### Форма 7: AdminUserManagementForm (Управление аккаунтами)
**Назначение:**
Позволяет административным пользователям управлять ролями и данным пользователей.

- Элементы управления:

DataGrid — список пользователей с их ролями

Button "Изменить роль" — открывает диалог с радиобатонами (Пользователь, Клинер, Админ)

Button "Удалить" для управления данными.

Button 'Города' - переход на форму со списком городов.

Button 'Заявки' - переход на форму со списком заявок.

- **Действия:**
После выбора пользователя — изменение его роли обновляется в базе.

Нажатие кнопки 'Города' перенесёт на форму AdminCitiesManagementForm.

Нажатие кнопки 'Заявки' перенесёт на форму AdminRequestsManagementForm.

### Форма 8: AdminRequestsManagementForm (Управление заявками)
**Назначение:**
Позволяет администраторам просматривать и редактировать заявки.

- Элементы управления:

DataGrid — список заявок

Button "Изменить статус" — открывает диалог для выбора нового статуса

Dropdown — назначить клинера.

Button 'Города' - переход на форму со списком городов.

Button 'Пользователи' - переход на форму со списком пользователей.

- **Действия:**

После выбора заявки — можно изменить статус и назначить клинера, изменения сохраняются.

Нажатие кнопки 'Города' перенесёт на форму AdminCitiesManagementForm.

Нажатие кнопки 'Пользователи' перенесёт на форму AdminUserManagementForm.

### Форма 9: AdminCitiesManagementForm (Управление городами)
**Назначение:**
Редактирование перечня городов.

- Элементы управления:

DataGrid — список городов

TextBox — название города для добавления

Button "Добавить" — создает новый город

Button "Удалить" — удаляет выбранный город

Button 'Пользователи' - переход на форму со списком пользователей.

Button 'Заявки' - переход на форму со списком заявок.

- **Действия:**

Обновление списка и базы данных при добавлении или удалении.

Нажатие кнопки 'Заявки' перенесёт на форму AdminRequestsManagementForm.

Нажатие кнопки 'Пользователи' перенесёт на форму AdminUserManagementForm.
